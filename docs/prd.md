# 人格特质投资策略评估系统需求文档

## 1. 项目概述

### 1.1 系统名称
人格特质投资策略评估系统

### 1.2 系统描述
这是一个Web应用程序，用于评估用户的人格特质、数学/金融能力以及风险偏好，并推荐合适的投资策略。系统通过科学的测评方法和欧几里得距离算法，为用户提供个性化的投资建议和详细报告。支持本地化数据存储和历史记录回顾功能。

## 2. 核心功能\n
### 2.1 用户认证系统
- 邮件验证码登录功能
- 6位数字验证码，有效期5分钟
- 用户会话管理

### 2.2 测评流程

#### 2.2.1 人格特质测试（升级版）
基于Big Five Inventory (BFI)和16Personalities理论框架，融合自我观察与行为分析的综合评估：
\n**五大人格维度评估：**
- **开放性评估**：\n  - 喜欢尝试新事物（如投资新策略）的程度
  - 创意想法产生频率和接受度
  - 对新投资工具和市场的探索意愿
  - 面对未知投资机会的态度\n
- **尽责性评估**：
  - 做事计划性和守时习惯\n  - 风险规避倾向和谨慎程度
  - 投资决策前的研究深度
  - 长期目标坚持能力

- **外向性评估**：
  - 社交偏好和自信表达能力
  - 在群体中的活跃程度\n  - 分享投资观点和寻求建议的倾向
  - 独立决策vs集体讨论偏好
\n- **宜人性评估**：
  - 对他人的信任程度
  - 合作vs竞争的优先级
  - 投资建议接受度\n  - 市场情绪影响敏感度

- **神经质评估**：\n  - 焦虑和情绪波动频率
  - 压力敏感度和应对方式
  - 市场波动时的情绪反应\n  - 亏损容忍度和恢复能力\n
**交易特征综合评估：**
- **交易频率偏好**：日内交易、短线、中线、长线持有倾向
- **交易兴趣领域**：股票、基金、期货、数字货币等偏好
- **交易标的选择**：大盘股vs小盘股、成长股vs价值股偏好
- **交易策略倾向**：\n  - 主观性哲学工具：波浪理论、缠论、技术形态分析
  - 数据驱动型：量化分析、基本面分析、统计套利
  - 混合型：技术面结合基本面分析
- **风险管理习惯**：止损设置、仓位控制、分散投资实践
- **信息获取方式**：研报依赖度、社交媒体影响、独立研究比重

#### 2.2.2 数学与金融能力测试
涵盖概率、复利等金融数学知识的多选题\n
#### 2.2.3 风险偏好测试\n通过假设投资场景评估用户风险容忍度

### 2.3 数据处理与分析
- 使用欧几里得距离量化不同性格偏好
- 计算用户人格向量与预定义投资风格向量的匹配度
- 结合交易特征数据进行多维度投资性格画像构建
- 支持趋势跟踪、波段交易、价值投资等多种投资风格匹配
\n### 2.4 本地化存储与历史记录
- **本地数据存储**：使用浏览器LocalStorage和IndexedDB存储测试数据
- **历史记录管理**：保存每次测试的完整记录，包括测试时间、答题详情、评估结果\n- **历史回顾功能**：\n  - 测试历史列表展示，按时间倒序排列
  - 单次测试详情查看，包含当时的答题情况和分析结果
  - 历史趋势分析，展示人格特质变化曲线
  - 历史报告重新下载功能\n- **数据对比功能**：支持选择不同时间点的测试结果进行对比分析
- **数据导出**：支持将历史数据导出为JSON格式进行备份

### 2.5 报告生成与下载
- 自动生成包含评估结果和投资建议的PDF报告
- 支持报告预览和下载功能\n- 历史报告重新生成和下载\n- 本地报告缓存机制\n\n## 3. 技术架构

### 3.1 前端技术栈
- React.js (v18+)构建单页应用
- Redux或Context API进行状态管理
- Material-UI (MUI) 或 Tailwind CSS 提供UI组件\n- React Hook Form处理表单验证
- Axios处理HTTP请求\n- Dexie.js 管理IndexedDB本地数据库
- LocalStorage API 处理轻量级数据存储

### 3.2 后端技术栈
- Node.js + Express.js 构建API服务器
- MongoDB + Mongoose ODM 进行数据存储
- Math.js处理欧几里得距离计算
- pdf-lib或jsPDF生成PDF报告
- NodeMailer处理邮件发送

### 3.3 数据存储架构
采用混合存储策略：
```
[前端本地存储]
├── LocalStorage: 用户偏好设置、会话信息
├── IndexedDB: 测试历史记录、报告缓存
└── SessionStorage: 当前测试进度
\n[后端云存储]
├── MongoDB: 用户账户信息、统计数据
└── 临时存储: PDF报告生成缓存
```

### 3.4 系统架构
采用模块化微服务架构，确保低耦合和高可维护性：
```
[用户浏览器]<--> [前端SPA (React)] <--> [本地存储层(IndexedDB/LocalStorage)] \n                     |\n                     v
[REST API网关 (Express)] <--> [后端模块 (Node.js)]
                     |
                     v
[数据库 (MongoDB)] <--> [PDF生成器 (pdf-lib)] <--> [文件存储 (临时FS或S3)] <--> [邮件服务 (NodeMailer)]
```

## 4. API设计
\n### 4.1 统一端点结构
- 基础路径：/api/v1/\n- 认证相关：\n  - POST /api/v1/auth/send-code - 发送验证码
  - POST /api/v1/auth/verify-code - 验证登录\n- 测试相关：
  - POST /api/v1/tests/personality - 提交人格测试
  - POST /api/v1/tests/math-finance - 提交数学金融测试
  - POST /api/v1/tests/risk-preference - 提交风险偏好测试\n- 历史记录相关：
  - GET /api/v1/history/list - 获取测试历史列表
  - GET /api/v1/history/:id - 获取单次测试详情\n  - DELETE /api/v1/history/:id - 删除历史记录
- 报告相关：
  - POST /api/v1/quantify - 生成量化分析\n  - GET /api/v1/reports/download - 下载报告
  - GET /api/v1/reports/history/:id - 下载历史报告

### 4.2 本地存储数据结构
```javascript
// IndexedDB 测试记录结构
{
  id: 'test_timestamp',
  userId: 'user_email',
  testDate: '2025-11-10T10:39:10Z',
  testType: 'complete', // complete/personality/math/risk
  answers: {
    personality: [...],
    mathFinance: [...],
    riskPreference: [...]\n  },
  results: {
    personalityScores: {...},\n    mathScore: 85,
    riskLevel: 'moderate',
    investmentStyle: 'balanced'
  },\n  reportPath: 'local_cache/report_id.pdf'
}\n```
\n### 4.3 数据格式\n统一使用JSON格式进行请求和响应，包含标准化的错误处理机制。

## 5. 设计风格

### 5.1 整体风格
采用简约现代化设计，受Spotify暗模式启发的黑绿配色方案\n
### 5.2 配色方案
- 主色：黑色 (#000000) 作为背景色
- 强调色：Spotify绿 (#1DB954) 用于按钮、高亮和进度指示器
- 次要色：深灰 (#181818) 用于卡片面板，浅灰 (#B3B3B3) 用于文本
- 错误色：红色 (#E91429) 用于警报提示

### 5.3 视觉细节
- 按钮采用圆角设计，绿色填充配白色文字，悬停时带有微妙发光效果
- 进度条使用线性步进器以绿色显示流程阶段\n- 表单输入框采用干净设计，边框最小化，单选/复选框以绿色强调
- 报告预览采用黑色背景模态框，图表使用绿色强调色
- 历史记录列表采用时间轴设计，绿色节点标记重要测试节点

### 5.4 排版规范
- 字体：Inter或Helvetica等无衬线字体\n- 标题：粗体，24-32px\n- 正文：14-16px\n- 响应式布局，移动优先设计

## 6. 部署与测试

### 6.1 部署方案
- 前端：部署到Vercel或Netlify
- 后端：部署到Heroku或AWS EC2
- 数据库：使用MongoDB Atlas云托管\n\n### 6.2 测试策略
- 单元测试：Jest + React Testing Library\n- 集成测试：Postman测试API端点
- 端到端测试：Cypress自动化测试\n- 本地存储测试：IndexedDB和LocalStorage功能测试

## 7. 开发规范

### 7.1 代码管理
- 遵循Git Flow工作流
- 强制使用ESLint/Prettier代码规范
- PR审查机制\n\n### 7.2 错误处理
- 统一错误格式：{ error: { code: 'ERR_CODE', message: '描述', details: {} } }
- 前端使用toast通知进行错误提示
- 后端集中错误中间件处理异常
- Winston日志记录，包含请求ID用于追踪\n- 本地存储异常处理和数据恢复机制

## 8. 数据隐私与安全\n
### 8.1 本地数据保护
- 敏感数据本地加密存储
- 定期清理过期缓存数据
- 用户主动数据清除功能
\n### 8.2 数据同步策略
- 本地优先，云端备份的混合模式
- 离线模式下完整功能支持
- 网络恢复时自动同步机制