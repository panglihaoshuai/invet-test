# 人格特质投资策略评估系统需求文档

## 1. 项目概述

### 1.1 系统名称
人格特质投资策略评估系统

### 1.2 系统描述
这是一个Web应用程序，用于评估用户的人格特质、数学/金融能力以及风险偏好，并推荐合适的投资策略。系统通过科学的测评方法和欧几里得距离算法，为用户提供个性化的投资建议和详细报告。支持本地化数据存储和历史记录回顾功能。系统提供标准版和完整版两种测试模式，完整版融合多样化游戏测试体验，测试时长20-30分钟。

## 2. 核心功能

### 2.1 用户认证系统
- 邮件验证码登录功能
- 6位数字验证码，有效期5分钟
- 用户会话管理\n\n### 2.2 测试模式选择
\n#### 2.2.1 测试版本选择
- **标准版测试**：传统问卷形式，测试时长10-15分钟
- **完整版测试**：融合多样化游戏体验的深度测试，测试时长20-30分钟
- 用户可在开始前选择测试版本，系统会显示预估完成时间

### 2.3 测评流程
\n#### 2.3.1 人格特质测试（升级版）
基于Big Five Inventory (BFI)和16Personalities理论框架，融合自我观察与行为分析的综合评估：
\n**五大人格维度评估：**
- **开放性评估**：\n  - 喜欢尝试新事物（如投资新策略）的程度
  - 创意想法产生频率和接受度
  - 对新投资工具和市场的探索意愿
  - 面对未知投资机会的态度
\n- **尽责性评估**：\n  - 做事计划性和守时习惯
  - 风险规避倾向和谨慎程度
  - 投资决策前的研究深度
  - 长期目标坚持能力

- **外向性评估**：
  - 社交偏好和自信表达能力
  - 在群体中的活跃程度
  - 分享投资观点和寻求建议的倾向
  - 独立决策vs集体讨论偏好

- **宜人性评估**：\n  - 对他人的信任程度
  - 合作vs竞争的优先级
  - 投资建议接受度
  - 市场情绪影响敏感度

- **神经质评估**：
  - 焦虑和情绪波动频率
  - 压力敏感度和应对方式
  - 市场波动时的情绪反应
  - 亏损容忍度和恢复能力
\n**交易特征综合评估：**
- **交易频率偏好**：日内交易、短线、中线、长线持有倾向
- **交易兴趣领域**：股票、基金、期货、数字货币等偏好
- **交易标的选择**：大盘股vs小盘股、成长股vs价值股偏好
- **交易策略倾向**：
  - 主观性哲学工具：波浪理论、缠论、技术形态分析
  - 数据驱动型：量化分析、基本面分析、统计套利
  - 混合型：技术面结合基本面分析
- **风险管理习惯**：止损设置、仓位控制、分散投资实践
- **信息获取方式**：研报依赖度、社交媒体影响、独立研究比重

#### 2.3.2 数学与金融能力测试
涵盖概率、复利等金融数学知识的多选题

#### 2.3.3 风险偏好测试
\n**标准版：**
通过假设投资场景评估用户风险容忍度\n
**完整版游戏化测试：**
\n**气球风险游戏（Balloon Risk Game）：**
- **游戏机制**：
  - 用户面对一个气球，每次点击'扎一下'获得10金币
  - 扎得次数越多，气球爆炸风险越高
  - 爆炸临界点随机设定（8-25次之间），用户无法预知
  - 气球爆炸时，当轮所有金币清零\n  - 用户可随时选择'收手'保留当前金币
- **测试维度**：
  - 风险承受能力：平均每轮扎气球次数
  - 损失厌恶程度：爆炸后的行为变化
  - 收益预期：目标金币数量设定
  - 决策一致性：多轮游戏中策略稳定性
- **游戏设置**：
  - 总共进行5轮游戏\n  - 每轮开始前显示当前总金币数
  - 实时显示当轮已扎次数和累积金币
  - 提供'继续扎'和'收手'两个选项
  - 爆炸时有视觉和音效反馈

**等待收获游戏（测试耐心与纪律性）：**
- **游戏机制**：
  - 模拟长期持有投资，用户控制一个'农场'或'矿场'
  - 初始投资100金币，成长周期随机（10-30轮），每轮增长5-15%收益\n  - 随时可'收获'锁定当前收益，但早收获损失潜力
  - 等太久可能遇'风暴'事件减值20-50%
  - 用户可选择'加注'增加成长速度，但提高风险\n- **测试维度**：
  - 持有耐力：长线vs短线偏好\n  - 高耐心者倾向等满周期，反映价值投资心态
  - 低耐心者早卖，类似波段或超短线交易者
- **量化指标**：\n  - 平均等待轮数（>20轮=高耐心）
  - 加注频率（高=冒险偏好）
  - 胜率通过模拟历史回报计算
\n**拍卖竞价游戏（测试贪婪与锚定偏差）：**
- **游戏机制**：
  - 用户参与虚拟拍卖，竞拍'神秘资产'（如加密币或股票模拟）
  - 每轮资产起拍价10金币，用户出价增幅至少5金币
  - 出价过高可能'爆仓'（资产实际价值随机，低于出价则亏损）
  - 可随时退出锁定当前最低价
  - 偶尔有'锚定陷阱'，如显示虚假高价历史，诱导用户追高
- **测试维度**：
  - 捕捉贪婪（FOMO - Fear Of Missing Out）和锚定（受初始价影响）
  - 贪婪者常追高，类似趋势跟踪中过度杠杆\n  - 理性者早退，反映风险控制
- **量化指标**：
  - 平均出价倍数（>2倍起拍=高贪婪）
  - 退出时机（早退率高=低锚定偏差）
  - 行为数据可计算偏差分数
\n**双门选择游戏（测试损失厌恶与决策偏差）：**
- **游戏机制**：
  - 类似于蒙提霍尔问题变体，用户面对两扇门
  - 门A：固定+20金币（安全）
  - 门B：50% +50金币，50% -30金币（风险）
  - 用户初始选门后，显示提示（如'另一门可能更好'），可切换
  - 多轮后统计
- **测试维度**：
  - 评估损失厌恶（更怕亏本而选安全门）和现状偏差（不愿切换）
  - 高损失厌恶者偏好门A，类似保守价值投资\n  - 冒险者选B，反映期权或杠杆偏好\n- **量化指标**：
  - 选择门B比例（>60%=高风险容忍）
  - 切换频率（低=现状偏差强）
  - 用期望值计算整体行为偏好
\n**群体羊群游戏（测试从众心理与独立思考）：**
- **游戏机制**：
  - 用户在虚拟'市场广场'中决定买/卖资产
  - 屏幕显示'其他交易者'的选择（AI模拟群体行为，如多数人追涨）
  - 资产价格随机波动，用户有100金币，可买/卖
  - 显示'羊群指标'：如'80%交易者正在买入'，但实际结果随机\n  - 用户可忽略群体，选择独立策略；多轮后结算
- **测试维度**：
  - 识别从众偏好（羊群效应）
  - 从众者跟风，类似社交媒体驱动的趋势跟踪
  - 独立者反向操作，反映逆向投资心态\n- **量化指标**：
  - 跟从群体比例（>70%=高从众）
  - 独立决策胜率
  - 结合时间压力测试反应速度

**快速反应游戏（测试决策速度与情绪控制）：**\n- **游戏机制**：
  - 模拟日内交易，用户监控'价格图表'（随机生成K线）
  - 每轮10秒内响应信号（如价格突破），正确决策+10金币，超时或错判-5金币
  - 加入情绪干扰：如连续亏损后出现'复仇交易'诱导（高杠杆选项）
  - 可暂停'冷静期'避免冲动
- **测试维度**：
  - 评估情绪控制和速度偏好
  - 快决策者适合超短线；慢而稳者偏长线
  - 连续亏损后行为反映tilt（情绪失控）
- **量化指标**：\n  - 平均响应时间（<5秒=高速度偏好）\n  - 冷静期使用率（高=好情绪控制）
  - 计算冲动决策比例

### 2.4 游戏化测试引擎

#### 2.4.1 游戏框架
- **Canvas渲染引擎**：使用HTML5 Canvas绘制游戏界面\n- **动画系统**：CSS3动画配合JavaScript实现流畅交互
- **音效系统**：Web Audio API提供游戏音效反馈
- **数据收集**：实时记录用户游戏行为数据
- **游戏选择器**：用户可直接选择想要体验的游戏类型

#### 2.4.2 游戏数据分析
- **行为模式识别**：分析用户在游戏中的决策模式
- **风险偏好量化**：将游戏表现转换为风险偏好分数
- **情绪稳定性评估**：通过多轮游戏表现评估情绪控制能力
- **学习适应能力**：分析用户策略调整和学习曲线
- **多维度综合分析**：整合不同游戏的测试结果形成完整画像

#### 2.4.3 游戏选择与流程
- **自由选择模式**：用户可直接选择任意游戏开始体验
- **推荐流程模式**：系统根据测试进度推荐最适合的游戏
- **快速体验模式**：每个游戏提供2-3分钟的快速体验版本
- **完整测试模式**：按照科学测试流程完成所有游戏

### 2.5 数据处理与分析
- 使用欧几里得距离量化不同性格偏好
- 计算用户人格向量与预定义投资风格向量的匹配度
- 结合交易特征数据和多样化游戏测试数据进行多维度投资性格画像构建
- 支持趋势跟踪、波段交易、价值投资等多种投资风格匹配
- **多游戏数据融合算法**：将不同游戏的测试结果进行加权融合和交叉验证

### 2.6 本地化存储与历史记录
- **本地数据存储**：使用浏览器LocalStorage和IndexedDB存储测试数据
- **历史记录管理**：保存每次测试的完整记录，包括测试时间、答题详情、游戏表现、评估结果
- **历史回顾功能**：
  - 测试历史列表展示，按时间倒序排列
  - 单次测试详情查看，包含当时的答题情况、游戏回放和分析结果
  - 历史趋势分析，展示人格特质变化曲线
  - 历史报告重新下载功能
- **数据对比功能**：支持选择不同时间点的测试结果进行对比分析
- **数据导出**：支持将历史数据导出为JSON格式进行备份
- **游戏回放功能**：保存所有游戏过程数据，支持历史游戏表现回放

### 2.7 报告生成与下载
- 自动生成包含评估结果和投资建议的PDF报告
- **完整版报告增强**：包含多样化游戏测试分析、行为模式图表、风险偏好热力图
- 支持报告预览和下载功能
- 历史报告重新生成和下载
- 本地报告缓存机制

## 3. 技术架构

### 3.1 前端技术栈
- React.js (v18+)构建单页应用
- Redux或Context API进行状态管理
- Material-UI (MUI) 或 Tailwind CSS 提供UI组件
- React Hook Form处理表单验证
- Axios处理HTTP请求
- Dexie.js 管理IndexedDB本地数据库
- LocalStorage API 处理轻量级数据存储
- **游戏引擎相关**：
  - Konva.js 或 PixiJS 用于Canvas游戏渲染
  - Framer Motion 提供高级动画效果
  - Howler.js 处理游戏音效
  - Chart.js 生成游戏数据可视化图表
  - React Router 管理游戏路由和状态

### 3.2 后端技术栈
- Node.js + Express.js 构建API服务器
- MongoDB + Mongoose ODM 进行数据存储
- Math.js处理欧几里得距离计算
- pdf-lib或jsPDF生成PDF报告\n- NodeMailer处理邮件发送
- **游戏数据处理**：
  - TensorFlow.js 进行游戏行为模式分析
  - D3.js 生成复杂数据可视化\n  - 机器学习算法进行多游戏数据关联分析
\n### 3.3 数据存储架构
采用混合存储策略：
```
[前端本地存储]
├── LocalStorage: 用户偏好设置、会话信息、游戏选择记录
├── IndexedDB: 测试历史记录、多游戏回放数据、报告缓存
└── SessionStorage: 当前测试进度、游戏状态、跨游戏数据传递

[后端云存储]
├── MongoDB: 用户账户信息、统计数据、多游戏行为分析
└── 临时存储: PDF报告生成缓存
```

### 3.4 系统架构
采用模块化微服务架构，确保低耦合和高可维护性：
```
[用户浏览器]<--> [前端SPA (React)] <--> [多游戏引擎模块] <--> [本地存储层(IndexedDB/LocalStorage)]
                     |
                     v
[REST API网关 (Express)] <--> [后端模块 (Node.js)] <--> [多游戏数据分析引擎]
                     |
                     v
[数据库 (MongoDB)] <--> [PDF生成器 (pdf-lib)] <--> [文件存储 (临时FS或S3)] <--> [邮件服务 (NodeMailer)]\n```

## 4. API设计

### 4.1 统一端点结构
- 基础路径：/api/v1/
- 认证相关：\n  - POST /api/v1/auth/send-code - 发送验证码
  - POST /api/v1/auth/verify-code - 验证登录
- 测试相关：
  - POST /api/v1/tests/personality - 提交人格测试
  - POST /api/v1/tests/math-finance - 提交数学金融测试
  - POST /api/v1/tests/risk-preference - 提交风险偏好测试
- **多游戏相关API**：
  - POST /api/v1/games/balloon-risk - 提交气球游戏数据
  - POST /api/v1/games/waiting-harvest - 提交等待收获游戏数据
  - POST /api/v1/games/auction-bidding - 提交拍卖竞价游戏数据
  - POST /api/v1/games/double-door - 提交双门选择游戏数据
  - POST /api/v1/games/herd-behavior - 提交群体羊群游戏数据
  - POST /api/v1/games/quick-reaction - 提交快速反应游戏数据
  - GET /api/v1/games/list - 获取可用游戏列表
  - GET /api/v1/games/replay/:gameType/:gameId - 获取特定游戏回放数据
- 历史记录相关：
  - GET /api/v1/history/list - 获取测试历史列表
  - GET /api/v1/history/:id - 获取单次测试详情
  - DELETE /api/v1/history/:id - 删除历史记录
- 报告相关：
  - POST /api/v1/quantify - 生成量化分析
  - GET /api/v1/reports/download - 下载报告
  - GET /api/v1/reports/history/:id - 下载历史报告
\n### 4.2 本地存储数据结构
```javascript\n// IndexedDB 测试记录结构（多游戏版）
{
  id: 'test_timestamp',
  userId: 'user_email',
  testDate: '2025-11-10T10:39:10Z',
  testType: 'complete', // complete/personality/math/risk
  testVersion: 'standard/complete',
  answers: {\n    personality: [...],
    mathFinance: [...],
    riskPreference: [...]
  },
  gameData: {
    balloonRisk: {
      rounds: [...],
      totalCoins: 450,
      riskScore: 0.75
    },
    waitingHarvest: {
      rounds: [...],
      averageWaitingRounds: 18,
      patienceScore: 0.72,
      addBetFrequency: 0.3
    },
    auctionBidding: {\n      auctions: [...],
      averageBidMultiple: 1.8,
      greedScore: 0.65,
      anchoringBias: 0.4
    },
    doubleDoor: {
      choices: [...],
      riskDoorRatio: 0.6,
      switchFrequency: 0.3,
      lossAversionScore: 0.55
    },
    herdBehavior: {
      decisions: [...],
      conformityRatio: 0.45,
      independenceScore: 0.78
    },
    quickReaction: {
      rounds: [...],
      averageReactionTime: 1200,
      cooldownUsage: 0.8,
      emotionalControlScore: 0.85
    }
  },
  results: {
    personalityScores: {...},
    mathScore: 85,
    riskLevel: 'moderate',
    investmentStyle: 'balanced',
    gameAnalysis: {
      patienceLevel: 0.72,
      greedLevel: 0.65,
      lossAversion: 0.55,\n      conformityTendency: 0.45,
      emotionalControl: 0.85,
      riskTolerance: 0.75
    }
  },
  reportPath: 'local_cache/report_id.pdf'
}
```\n
### 4.3 数据格式
统一使用JSON格式进行请求和响应，包含标准化的错误处理机制。

## 5. 设计风格

### 5.1 整体风格
采用简约现代化设计，受Spotify暗模式启发的黑绿配色方案\n
### 5.2 配色方案
- 主色：黑色 (#000000) 作为背景色
- 强调色：Spotify绿 (#1DB954) 用于按钮、高亮和进度指示器
- 次要色：深灰 (#181818) 用于卡片面板，浅灰 (#B3B3B3) 用于文本
- 错误色：红色 (#E91429) 用于警报提示\n- **多游戏UI专用色**：
  - 金黄色 (#FFD700) 用于金币和奖励显示
  - 橙红色 (#FF4500) 用于警告和风险提示
  - 蓝色 (#1E90FF) 用于信息和数据显示
  - 紫色 (#9370DB) 用于社交和影响相关元素

### 5.3 视觉细节
- 按钮采用圆角设计，绿色填充配白色文字，悬停时带有微妙发光效果
- 进度条使用线性步进器以绿色显示流程阶段
- 表单输入框采用干净设计，边框最小化，单选/复选框以绿色强调
- 报告预览采用黑色背景模态框，图表使用绿色强调色
- 历史记录列表采用时间轴设计，绿色节点标记重要测试节点
- **多游戏界面设计**：
  - 游戏选择界面采用卡片网格布局，每个游戏卡片有独特的主题色
  - 气球游戏采用渐变背景，气球随扎击次数变色（绿→黄→橙→红）
  - 等待收获游戏采用农场/矿场主题，成长进度条和收益显示
  - 拍卖竞价游戏采用拍卖行界面风格，实时竞价显示
  - 双门选择游戏采用简洁的门选择界面，切换动画效果
  - 群体羊群游戏采用市场广场风格，群体指标和独立决策提示
  - 快速反应游戏采用交易界面风格，K线图和快速决策按钮
  - 所有游戏统一采用圆角按钮和阴影效果
  - 游戏进度和得分采用动画数字效果

### 5.4 排版规范
- 字体：Inter或Helvetica等无衬线字体
- 标题：粗体，24-32px\n- 正文：14-16px
- 响应式布局，移动优先设计
- **游戏UI字体**：游戏内数字采用等宽字体，确保数字变化时布局稳定

## 6. 部署与测试

### 6.1 部署方案
- 前端：部署到Vercel或Netlify
- 后端：部署到Heroku或AWS EC2
- 数据库：使用MongoDB Atlas云托管
\n### 6.2 测试策略
- 单元测试：Jest + React Testing Library
- 集成测试：Postman测试API端点
- 端到端测试：Cypress自动化测试
- 本地存储测试：IndexedDB和LocalStorage功能测试
- **多游戏测试**：
  - 每个游戏的逻辑单元测试
  - 游戏性能和内存泄漏测试
  - 跨浏览器游戏兼容性测试
  - 多游戏数据收集和分析准确性测试
  - 游戏切换和状态保存测试

## 7. 开发规范

### 7.1 代码管理
- 遵循Git Flow工作流\n- 强制使用ESLint/Prettier代码规范
- PR审查机制

### 7.2 错误处理
- 统一错误格式：{ error: { code: 'ERR_CODE', message: '描述', details: {} } }
- 前端使用toast通知进行错误提示
- 后端集中错误中间件处理异常
- Winston日志记录，包含请求ID用于追踪
- 本地存储异常处理和数据恢复机制
- **多游戏错误处理**：游戏崩溃时自动保存进度，支持断点续玩和游戏切换

## 8. 数据隐私与安全

### 8.1 本地数据保护
- 敏感数据本地加密存储
- 定期清理过期缓存数据
- 用户主动数据清除功能
\n### 8.2 数据同步策略
- 本地优先，云端备份的混合模式
- 离线模式下完整功能支持
- 网络恢复时自动同步机制
\n## 9. 用户体验优化
\n### 9.1 测试版本引导
- 首次用户默认推荐完整版体验
- 提供测试版本对比说明
- 支持测试过程中版本切换（保留已完成部分）

### 9.2 游戏化体验设计
- 测试进度gamification，完成各阶段获得成就徽章
- **多游戏选择体验**：
  - 游戏大厅界面，展示所有可用游戏
  - 每个游戏提供预览和难度说明
  - 支持游戏收藏和个人推荐
  - 游戏完成后显示即时反馈和建议下一个游戏
- 游戏教程和引导动画
- 实时反馈和鼓励机制
- 社交分享功能（匿名化测试结果分享）
- **自由探索模式**：用户可随时选择任意游戏开始，无需按固定流程