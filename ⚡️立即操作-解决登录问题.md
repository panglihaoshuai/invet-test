# âš¡ï¸ ç«‹å³æ“ä½œ - è§£å†³ç™»å½•é—®é¢˜

## ğŸ¯ é—®é¢˜åŸå› 

PostgREST çš„ç¼“å­˜æ²¡æœ‰æ›´æ–°ï¼Œå¯¼è‡´ API æ— æ³•è¯†åˆ« `users` è¡¨ã€‚

**è¿™ä¸æ˜¯ä»£ç é—®é¢˜ï¼Œæ˜¯ Supabase æœåŠ¡çš„ç¼“å­˜é—®é¢˜ã€‚**

---

## ğŸš€ è§£å†³æ–¹æ³•ï¼ˆ5 åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1: ç™»å½• Supabase Dashboard

1. è®¿é—®ï¼šhttps://supabase.com/dashboard
2. ç™»å½•æ‚¨çš„è´¦å·
3. é€‰æ‹©é¡¹ç›®ï¼š`investment-personality-system`

### æ­¥éª¤ 2: é‡æ–°åŠ è½½ Schema Cache

**æ–¹æ³• Aï¼šé€šè¿‡ API Settingsï¼ˆæ¨èï¼‰**

1. ç‚¹å‡»å·¦ä¾§èœå• `Settings`ï¼ˆè®¾ç½®ï¼‰
2. ç‚¹å‡» `API`
3. æ‰¾åˆ° `PostgREST` éƒ¨åˆ†
4. ç‚¹å‡» `Restart` æˆ– `Reload Schema Cache` æŒ‰é’®
5. ç­‰å¾… 1-2 åˆ†é’Ÿ

**æ–¹æ³• Bï¼šé€šè¿‡ SQL Editor**

1. ç‚¹å‡»å·¦ä¾§èœå• `SQL Editor`
2. æ–°å»ºæŸ¥è¯¢
3. è¾“å…¥ä»¥ä¸‹ SQLï¼š
   ```sql
   NOTIFY pgrst, 'reload schema';
   ```
4. ç‚¹å‡» `Run` æ‰§è¡Œ
5. ç­‰å¾… 1-2 åˆ†é’Ÿ

**æ–¹æ³• Cï¼šé‡æ–°åˆ›å»ºè¡¨ï¼ˆæœ€å¯é ï¼‰**

1. ç‚¹å‡»å·¦ä¾§èœå• `Database`
2. ç‚¹å‡» `Tables`
3. ç‚¹å‡» `New Table` æŒ‰é’®
4. å¡«å†™è¡¨ä¿¡æ¯ï¼š
   - **Name**: `users`
   - **Description**: ç”¨æˆ·è¡¨
5. æ·»åŠ åˆ—ï¼š
   
   | Column Name | Type | Default Value | Primary | Unique | Nullable |
   |------------|------|---------------|---------|--------|----------|
   | id | uuid | gen_random_uuid() | âœ… | âœ… | âŒ |
   | email | text | - | âŒ | âœ… | âŒ |
   | created_at | timestamptz | now() | âŒ | âŒ | âŒ |
   | updated_at | timestamptz | now() | âŒ | âŒ | âŒ |

6. **é‡è¦ï¼šç¦ç”¨ RLS**
   - åœ¨è¡¨è®¾ç½®ä¸­æ‰¾åˆ° `Enable Row Level Security (RLS)`
   - ç¡®ä¿å®ƒæ˜¯ **å…³é—­** çŠ¶æ€

7. ç‚¹å‡» `Save` ä¿å­˜

### æ­¥éª¤ 3: éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ

1. å›åˆ°åº”ç”¨é¡µé¢
2. æŒ‰ `F5` åˆ·æ–°é¡µé¢
3. å°è¯•ç™»å½•ï¼š
   - è¾“å…¥é‚®ç®±ï¼š`1062250152@qq.com`
   - å‘é€éªŒè¯ç 
   - è¾“å…¥éªŒè¯ç 
   - ç‚¹å‡»éªŒè¯ç™»å½•

4. **åº”è¯¥æˆåŠŸäº†ï¼** âœ…

---

## ğŸ“Š å¦‚ä½•ç¡®è®¤é—®é¢˜å·²è§£å†³ï¼Ÿ

### æˆåŠŸçš„æ ‡å¿—

1. **é¡µé¢è¡Œä¸º**
   - éªŒè¯ç éªŒè¯æˆåŠŸ
   - è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ
   - æ²¡æœ‰é”™è¯¯æç¤º

2. **Console è¾“å‡º**ï¼ˆæŒ‰ F12 æŸ¥çœ‹ï¼‰
   ```javascript
   [upsertUser] å¼€å§‹å¤„ç†é‚®ç®±: 1062250152@qq.com
   [upsertUser] è°ƒç”¨ Edge Function upsert-user...
   [upsertUser] Edge Function è°ƒç”¨ç»“æœ: { data: { data: {...} }, error: null }
   [upsertUser] ç”¨æˆ·åˆ›å»º/è·å–æˆåŠŸ
   ```

3. **Network æ ‡ç­¾é¡µ**
   - çœ‹åˆ°æˆåŠŸçš„ API è°ƒç”¨
   - çŠ¶æ€ç ï¼š200 OK
   - è¿”å›ç”¨æˆ·æ•°æ®

---

## â° å¦‚æœç«‹å³æ“ä½œä¸æˆåŠŸ

### ç­‰å¾…è‡ªåŠ¨åˆ·æ–°

1. **ç­‰å¾…æ—¶é—´ï¼š10-30 åˆ†é’Ÿ**
2. **æ¯ 10 åˆ†é’Ÿå°è¯•ä¸€æ¬¡ç™»å½•**
3. **è§‚å¯Ÿé”™è¯¯ä¿¡æ¯æ˜¯å¦å˜åŒ–**

### ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…ï¼Ÿ

- Supabase æ‰˜ç®¡ç¯å¢ƒä¸­ï¼ŒPostgREST ä¼šå®šæœŸè‡ªåŠ¨åˆ·æ–°ç¼“å­˜
- åˆ·æ–°é—´éš”å¯èƒ½æ˜¯ 10-30 åˆ†é’Ÿ
- æˆ‘ä»¬å·²ç»å‘é€äº† NOTIFY å‘½ä»¤ï¼Œåªæ˜¯éœ€è¦æ—¶é—´ä¼ æ’­

---

## ğŸ†˜ å¦‚æœä»ç„¶ä¸æˆåŠŸ

### è”ç³» Supabase æ”¯æŒ

1. **è®¿é—®ï¼š** https://supabase.com/dashboard/support
2. **é—®é¢˜æè¿°ï¼š**
   ```
   PostgREST schema cache not updating after table creation
   
   Project ID: ahgnspudsmrvsqcinxcj
   Error Code: PGRST205, PGRST202
   Table Name: public.users
   
   I have tried:
   - Sending NOTIFY pgrst command
   - Recreating the table
   - Creating RPC functions
   - Waiting for auto-refresh
   
   The table exists in the database and works with direct SQL,
   but the REST API returns 404 errors.
   
   Please help refresh the PostgREST schema cache.
   ```

---

## ğŸ’¡ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

### æŠ€æœ¯åŸå› 

```
æ­£å¸¸æµç¨‹ï¼š
åˆ›å»ºè¡¨ â†’ PostgREST è‡ªåŠ¨æ£€æµ‹ â†’ æ›´æ–°ç¼“å­˜ â†’ API å¯ç”¨

å½“å‰æƒ…å†µï¼š
åˆ›å»ºè¡¨ â†’ PostgREST æœªæ£€æµ‹åˆ° â†’ ç¼“å­˜æœªæ›´æ–° â†’ API è¿”å› 404
```

### è§£å†³åŸç†

```
æ‰‹åŠ¨åˆ·æ–°ï¼š
é‡å¯ PostgREST â†’ é‡æ–°åŠ è½½ schema â†’ ç¼“å­˜æ›´æ–° â†’ API å¯ç”¨

é€šè¿‡ Dashboard åˆ›å»ºï¼š
Dashboard åˆ›å»ºè¡¨ â†’ è‡ªåŠ¨è§¦å‘ç¼“å­˜æ›´æ–° â†’ API ç«‹å³å¯ç”¨
```

---

## ğŸ“ æ€»ç»“

### é—®é¢˜
- âŒ PostgREST ç¼“å­˜æœªæ›´æ–°
- âŒ API æ— æ³•è¯†åˆ« users è¡¨
- âŒ ç™»å½•åŠŸèƒ½æ— æ³•åˆ›å»ºç”¨æˆ·

### è§£å†³æ–¹æ¡ˆ
1. **ç«‹å³æ“ä½œï¼š** æ‰‹åŠ¨åˆ·æ–° PostgREST ç¼“å­˜ï¼ˆ5 åˆ†é’Ÿï¼‰
2. **ç­‰å¾…æ–¹æ¡ˆï¼š** ç­‰å¾…è‡ªåŠ¨åˆ·æ–°ï¼ˆ10-30 åˆ†é’Ÿï¼‰
3. **æœ€åæ‰‹æ®µï¼š** è”ç³» Supabase æ”¯æŒ

### é¢„æœŸç»“æœ
- âœ… ç¼“å­˜æ›´æ–°
- âœ… API æ­£å¸¸å·¥ä½œ
- âœ… ç™»å½•åŠŸèƒ½å¯ç”¨

---

**ç°åœ¨å°±å» Supabase Dashboard æ“ä½œå§ï¼** ğŸš€

**è¯¦ç»†æŠ€æœ¯è¯´æ˜è¯·æŸ¥çœ‹ï¼š** `ğŸš¨ç´§æ€¥-PostgRESTç¼“å­˜é—®é¢˜è¯´æ˜.md`
