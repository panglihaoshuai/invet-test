{
  "meta": {
    "project": "人格特质投资策略评估系统",
    "date": "2025-11-14",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "基于 Big Five 人格模型的智能投资策略推荐系统，通过科学测评帮助用户了解人格特质、数学金融能力及风险偏好，提供个性化投资策略建议与AI深度心理分析。",
  "core_goals": [
    "支持用户通过邮箱+密码或验证码方式安全登录及注册，确保数据安全和便捷访问。",
    "提供基于五大人格和多维度测试的数据分析，精准评估用户投资心理和风格。",
    "实现个性化智能投资策略推荐，辅以AI深度心理分析（付费功能）。",
    "支持灵活的支付系统，包括递减价格策略和礼品码系统，保障商业运营。",
    "构建完善的管理员后台，实现用户、订单、礼品码及系统配置的全方位管理。",
    "支持中英文双语及日期本地化，提升国际化用户体验。"
  ],
  "key_features": [
    "邮箱注册登录及验证码登录功能，支持一次性密码和密码免输入登录。",
    "人格特质、交易特征、数学金融能力及风险偏好等多维度测试。",
    "基于欧几里得距离算法的智能投资策略匹配。",
    "DeepSeek AI集成，生成详细的AI投资心理分析报告，支持中英语言切换。",
    "支付与订单管理，支持Stripe支付及订单验证。",
    "礼品码系统，支持多次使用、有效期设置及激活控制。",
    "管理员功能：管理员与黑名单管理，用户与订单管理，系统统计及配置。",
    "前端使用React、TypeScript、TailwindCSS等现代技术栈，后端基于Supabase及Edge Functions。"
  ],
  "user_flow_summary": [
    "用户访问登录页，可选择注册或登录模式。",
    "注册时输入邮箱，系统生成一次性密码并完成注册，成功后复制账号密码至剪贴板。",
    "用户登录后完成人格、交易、数学与风险偏好测试。",
    "用户提交测试后，系统生成个性化投资策略及基础报告。",
    "付费用户可使用DeepSeek AI生成深度分析报告，支持礼品码兑换。",
    "用户可查看测试历史、对比测试结果及支付状态页面。",
    "管理员通过后台添加管理员账号，管理黑名单邮箱，维护系统安全。",
    "管理员管理礼品码，订单及用户数据，监控系统运营情况。"
  ],
  "validation_criteria": [
    "注册与登录流程正确运行，密码及验证码验证无误，账户信息安全存储。",
    "测试数据完整采集且正确关联用户帐号。",
    "支付流程（包括Stripe及礼品码）顺利完成，订单状态准确更新。",
    "DeepSeek AI分析生成正常，支持中英文切换，报告内容准确。",
    "管理员权限严格控制，黑名单功能有效阻止被拉黑用户登录。",
    "国际化及日期格式本地化功能正常。",
    "系统稳定运行，前后端通信顺畅，符合代码规范和安全标准。"
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "React",
      "Vite",
      "TailwindCSS",
      "Radix UI",
      "Supabase (Postgres, Edge Functions)",
      "Stripe",
      "DeepSeek API",
      "date-fns"
    ],
    "features": [
      {
        "name": "Auth Context",
        "description": "提供登录、注册、验证码登录逻辑与状态",
        "files": [
          "src/contexts/AuthContext.tsx",
          "supabase/functions/login-password/index.ts",
          "supabase/functions/register-password/index.ts",
          "supabase/functions/verify-code-and-login/index.ts",
          "supabase/functions/send-verification-code/index.ts"
        ]
      },
      {
        "name": "测试上下文",
        "description": "管理测试ID与人格/交易/数学/风险数据",
        "files": [
          "src/contexts/TestContext.tsx"
        ]
      },
      {
        "name": "支付与订单",
        "description": "创建结账、验证支付、订单记录与关联测试结果",
        "files": [
          "src/db/api.ts",
          "supabase/functions/create_stripe_checkout/index.ts",
          "supabase/functions/verify_stripe_payment/index.ts"
        ]
      },
      {
        "name": "DeepSeek分析",
        "description": "生成并展示AI投资心理分析，支持中英切换",
        "files": [
          "supabase/functions/generate_deepseek_analysis/index.ts",
          "src/components/analysis/DeepSeekAnalysisCard.tsx",
          "src/db/api.ts"
        ]
      },
      {
        "name": "页面路由与视图",
        "description": "登录、结果、历史、对比、支付成功等页面",
        "files": [
          "src/pages/LoginPage.tsx",
          "src/pages/ResultPage.tsx",
          "src/pages/TestHistoryPage.tsx",
          "src/pages/TestComparisonPage.tsx",
          "src/pages/HistoricalResultPage.tsx",
          "src/pages/PaymentSuccessPage.tsx",
          "src/App.tsx"
        ]
      },
      {
        "name": "国际化与日期本地化",
        "description": "全局语言上下文与字典、页面文案与日期格式联动",
        "files": [
          "src/contexts/LanguageContext.tsx",
          "src/i18n/dict.ts",
          "src/i18n/index.ts",
          "src/pages/TestHistoryPage.tsx",
          "src/pages/TestComparisonPage.tsx",
          "src/pages/HistoricalResultPage.tsx"
        ]
      },
      {
        "name": "本地存储与工具",
        "description": "测试结果、偏好、DeepSeek分析的本地存储",
        "files": [
          "src/utils/localStorage.ts"
        ]
      }
    ]
  }
}
